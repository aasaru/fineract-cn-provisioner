FROM openjdk:8-jdk-alpine

ARG provisioner_port=2020

ENV server.max-http-header-size=16384 \
    bonecp.partitionCount=1 \
    bonecp.maxConnectionsPerPartition=4 \
    bonecp.minConnectionsPerPartition=1 \
    bonecp.acquireIncrement=1 \
    server.port=9090 \
    cassandra.clusterName="Test Cluster" \
    cassandra.contactPoints=host.docker.internal:9042 \
    cassandra.keyspace=seshat \
    cassandra.cl.read=ONE \
    cassandra.cl.write=ONE \
    cassandra.cl.delete=ONE \
    mariadb.driverClass=org.mariadb.jdbc.Driver \
    mariadb.database=seshat \
    mariadb.host=host.docker.internal \
    mariadb.port=3306 \
    mariadb.user=root \
    mariadb.password=mysql \
    spring.cloud.discovery.enabled=false \
    spring.cloud.config.enabled=false \
    flyway.enabled=false \
    feign.hystrix.enabled=false \
    ribbon.eureka.enabled=false \
    ribbon.listOfServers=172.16.238.2:9090 \
    eureka.client.serviceUrl.defaultZone=http://172.16.238.2:8761/eureka \
    spring.cloud.discovery.enabled=true \
    eureka.instance.hostname=172.16.238.2 \
    eureka.client.fetchRegistry=true \
    eureka.registration.enabled=false \
    eureka.instance.leaseRenewalIntervalInSeconds=1 \
    eureka.client.instanceInfoReplicationIntervalSeconds=1 \
    activemq.brokerUrl=tcp://172.16.238.3:61616 \
    ribbon.eureka.enabled=true \
    system.initialclientid=service-runner \
    spring.profiles.active=production \
    system.publicKey.timestamp=2019-01-07T08_10_29 \
    system.publicKey.modulus=17498514117889697053887307436470430799928196825273667797071743452054603238981563606779248180404497808751979254629801626150541818852493364318491429032596218267474274551494054307741537102598581384202361357797628505194051342528177008079523458663665344397099838975353512828326159695259205717705546626407564515624904175950594979892531283149528872059568909463507945144405593962390786501166898270505666690293409981599843145834484605778278011651224391039280340418834724039783910064662683566979845785773815720722964206526863036911453241862196578997239466758158798791291570066336967700558212973684369103586228774557427102042891 \
    system.publicKey.exponent=65537 \
    system.privateKey.timestamp=2019-01-07T08_10_29 \
    system.privateKey.modulus=17498514117889697053887307436470430799928196825273667797071743452054603238981563606779248180404497808751979254629801626150541818852493364318491429032596218267474274551494054307741537102598581384202361357797628505194051342528177008079523458663665344397099838975353512828326159695259205717705546626407564515624904175950594979892531283149528872059568909463507945144405593962390786501166898270505666690293409981599843145834484605778278011651224391039280340418834724039783910064662683566979845785773815720722964206526863036911453241862196578997239466758158798791291570066336967700558212973684369103586228774557427102042891 \
    system.privateKey.exponent=14071809657981608920625337806495584394290488690089538946077362332020595305003972515801558155726662007944452182076604591345530089552206505938286064121105917136132210685374538721346754198670263129096801053450850895055344124773219904127670244929599381200853759151594613525051094716255640614313066265644717833696467348626513044696649100921684579717808044964658831436924043810103062795062370287281676613909735080913048970124444736598293320756619810331434224526027751233387790615579286706963356755206925671952319566106970878735192660715757048253356569036275850444325988840055365278629562541137381590383637721018109489509673

WORKDIR /tmp
COPY service/build/libs/service-0.1.0-BUILD-SNAPSHOT-boot.jar provisioner-service-boot-0.1.0-BUILD-SNAPSHOT.jar
ENV spring.application.name="provisioner-v1" \
    server.port=$provisioner_port \
    server.contextPath="/provisioner-v1"

CMD ["java", "-jar", "provisioner-service-boot-0.1.0-BUILD-SNAPSHOT.jar"]

